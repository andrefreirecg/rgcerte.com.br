{"version":3,"names":["_classnames","_interopRequireDefault","require","_element","_blocks","_data","_keyboardShortcuts","_blockSelectionButton","_blockContextualToolbar","_store","_blockPopover","_useBlockToolbarPopoverProps","_inserter","_useShouldContextualToolbarShow","selector","select","__unstableGetEditorMode","hasMultiSelection","isTyping","getLastMultiSelectedBlockClientId","blockEditorStore","editorMode","lastClientId","SelectedBlockPopover","clientId","rootClientId","isEmptyDefaultBlock","capturingClientId","__unstablePopoverSlot","__unstableContentRef","useSelect","isInsertionPointVisible","isBlockInsertionPointVisible","getBlockInsertionPoint","getBlockOrder","insertionPoint","order","index","isToolbarForced","useRef","shouldShowContextualToolbar","canFocusHiddenToolbar","useShouldContextualToolbarShow","stopTyping","useDispatch","showEmptyBlockSideInserter","shouldShowBreadcrumb","useShortcut","current","isDisabled","useEffect","initialToolbarItemIndexRef","undefined","popoverProps","useBlockToolbarPopoverProps","contentElement","_react","createElement","default","__unstableCoverTarget","bottomClientId","className","classnames","resize","shift","position","__experimentalIsQuick","focusOnMount","__experimentalInitialIndex","__experimentalOnIndexChange","key","wrapperSelector","getSelectedBlockClientId","getFirstMultiSelectedBlockClientId","getBlockRootClientId","getBlock","getBlockParents","__experimentalGetBlockListSettingsForBlocks","name","attributes","blockParentsClientIds","parentBlockListSettings","find","parentClientId","__experimentalCaptureToolbars","isUnmodifiedDefaultBlock","WrappedBlockPopover","selected"],"sources":["@wordpress/block-editor/src/components/block-tools/selected-block-popover.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useRef, useEffect } from '@wordpress/element';\nimport { isUnmodifiedDefaultBlock } from '@wordpress/blocks';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { useShortcut } from '@wordpress/keyboard-shortcuts';\n\n/**\n * Internal dependencies\n */\nimport BlockSelectionButton from './block-selection-button';\nimport BlockContextualToolbar from './block-contextual-toolbar';\nimport { store as blockEditorStore } from '../../store';\nimport BlockPopover from '../block-popover';\nimport useBlockToolbarPopoverProps from './use-block-toolbar-popover-props';\nimport Inserter from '../inserter';\nimport { useShouldContextualToolbarShow } from '../../utils/use-should-contextual-toolbar-show';\n\nfunction selector( select ) {\n\tconst {\n\t\t__unstableGetEditorMode,\n\t\thasMultiSelection,\n\t\tisTyping,\n\t\tgetLastMultiSelectedBlockClientId,\n\t} = select( blockEditorStore );\n\n\treturn {\n\t\teditorMode: __unstableGetEditorMode(),\n\t\thasMultiSelection: hasMultiSelection(),\n\t\tisTyping: isTyping(),\n\t\tlastClientId: hasMultiSelection()\n\t\t\t? getLastMultiSelectedBlockClientId()\n\t\t\t: null,\n\t};\n}\n\nfunction SelectedBlockPopover( {\n\tclientId,\n\trootClientId,\n\tisEmptyDefaultBlock,\n\tcapturingClientId,\n\t__unstablePopoverSlot,\n\t__unstableContentRef,\n} ) {\n\tconst { editorMode, hasMultiSelection, isTyping, lastClientId } = useSelect(\n\t\tselector,\n\t\t[]\n\t);\n\n\tconst isInsertionPointVisible = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tisBlockInsertionPointVisible,\n\t\t\t\tgetBlockInsertionPoint,\n\t\t\t\tgetBlockOrder,\n\t\t\t} = select( blockEditorStore );\n\n\t\t\tif ( ! isBlockInsertionPointVisible() ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\t\tconst order = getBlockOrder( insertionPoint.rootClientId );\n\t\t\treturn order[ insertionPoint.index ] === clientId;\n\t\t},\n\t\t[ clientId ]\n\t);\n\tconst isToolbarForced = useRef( false );\n\tconst { shouldShowContextualToolbar, canFocusHiddenToolbar } =\n\t\tuseShouldContextualToolbarShow();\n\n\tconst { stopTyping } = useDispatch( blockEditorStore );\n\n\tconst showEmptyBlockSideInserter =\n\t\t! isTyping && editorMode === 'edit' && isEmptyDefaultBlock;\n\tconst shouldShowBreadcrumb =\n\t\t! hasMultiSelection &&\n\t\t( editorMode === 'navigation' || editorMode === 'zoom-out' );\n\n\tuseShortcut(\n\t\t'core/block-editor/focus-toolbar',\n\t\t() => {\n\t\t\tisToolbarForced.current = true;\n\t\t\tstopTyping( true );\n\t\t},\n\t\t{\n\t\t\tisDisabled: ! canFocusHiddenToolbar,\n\t\t}\n\t);\n\n\tuseEffect( () => {\n\t\tisToolbarForced.current = false;\n\t} );\n\n\t// Stores the active toolbar item index so the block toolbar can return focus\n\t// to it when re-mounting.\n\tconst initialToolbarItemIndexRef = useRef();\n\n\tuseEffect( () => {\n\t\t// Resets the index whenever the active block changes so this is not\n\t\t// persisted. See https://github.com/WordPress/gutenberg/pull/25760#issuecomment-717906169\n\t\tinitialToolbarItemIndexRef.current = undefined;\n\t}, [ clientId ] );\n\n\tconst popoverProps = useBlockToolbarPopoverProps( {\n\t\tcontentElement: __unstableContentRef?.current,\n\t\tclientId,\n\t} );\n\n\tif ( showEmptyBlockSideInserter ) {\n\t\treturn (\n\t\t\t<BlockPopover\n\t\t\t\tclientId={ capturingClientId || clientId }\n\t\t\t\t__unstableCoverTarget\n\t\t\t\tbottomClientId={ lastClientId }\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\t'block-editor-block-list__block-side-inserter-popover',\n\t\t\t\t\t{\n\t\t\t\t\t\t'is-insertion-point-visible': isInsertionPointVisible,\n\t\t\t\t\t}\n\t\t\t\t) }\n\t\t\t\t__unstablePopoverSlot={ __unstablePopoverSlot }\n\t\t\t\t__unstableContentRef={ __unstableContentRef }\n\t\t\t\tresize={ false }\n\t\t\t\tshift={ false }\n\t\t\t\t{ ...popoverProps }\n\t\t\t>\n\t\t\t\t<div className=\"block-editor-block-list__empty-block-inserter\">\n\t\t\t\t\t<Inserter\n\t\t\t\t\t\tposition=\"bottom right\"\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\t__experimentalIsQuick\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</BlockPopover>\n\t\t);\n\t}\n\n\tif ( shouldShowBreadcrumb || shouldShowContextualToolbar ) {\n\t\treturn (\n\t\t\t<BlockPopover\n\t\t\t\tclientId={ capturingClientId || clientId }\n\t\t\t\tbottomClientId={ lastClientId }\n\t\t\t\tclassName={ classnames(\n\t\t\t\t\t'block-editor-block-list__block-popover',\n\t\t\t\t\t{\n\t\t\t\t\t\t'is-insertion-point-visible': isInsertionPointVisible,\n\t\t\t\t\t}\n\t\t\t\t) }\n\t\t\t\t__unstablePopoverSlot={ __unstablePopoverSlot }\n\t\t\t\t__unstableContentRef={ __unstableContentRef }\n\t\t\t\tresize={ false }\n\t\t\t\t{ ...popoverProps }\n\t\t\t>\n\t\t\t\t{ shouldShowContextualToolbar && (\n\t\t\t\t\t<BlockContextualToolbar\n\t\t\t\t\t\t// If the toolbar is being shown because of being forced\n\t\t\t\t\t\t// it should focus the toolbar right after the mount.\n\t\t\t\t\t\tfocusOnMount={ isToolbarForced.current }\n\t\t\t\t\t\t__experimentalInitialIndex={\n\t\t\t\t\t\t\tinitialToolbarItemIndexRef.current\n\t\t\t\t\t\t}\n\t\t\t\t\t\t__experimentalOnIndexChange={ ( index ) => {\n\t\t\t\t\t\t\tinitialToolbarItemIndexRef.current = index;\n\t\t\t\t\t\t} }\n\t\t\t\t\t\t// Resets the index whenever the active block changes so\n\t\t\t\t\t\t// this is not persisted. See https://github.com/WordPress/gutenberg/pull/25760#issuecomment-717906169\n\t\t\t\t\t\tkey={ clientId }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ shouldShowBreadcrumb && (\n\t\t\t\t\t<BlockSelectionButton\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</BlockPopover>\n\t\t);\n\t}\n\n\treturn null;\n}\n\nfunction wrapperSelector( select ) {\n\tconst {\n\t\tgetSelectedBlockClientId,\n\t\tgetFirstMultiSelectedBlockClientId,\n\t\tgetBlockRootClientId,\n\t\tgetBlock,\n\t\tgetBlockParents,\n\t\t__experimentalGetBlockListSettingsForBlocks,\n\t} = select( blockEditorStore );\n\n\tconst clientId =\n\t\tgetSelectedBlockClientId() || getFirstMultiSelectedBlockClientId();\n\n\tif ( ! clientId ) {\n\t\treturn;\n\t}\n\n\tconst { name, attributes = {} } = getBlock( clientId ) || {};\n\tconst blockParentsClientIds = getBlockParents( clientId );\n\n\t// Get Block List Settings for all ancestors of the current Block clientId.\n\tconst parentBlockListSettings = __experimentalGetBlockListSettingsForBlocks(\n\t\tblockParentsClientIds\n\t);\n\n\t// Get the clientId of the topmost parent with the capture toolbars setting.\n\tconst capturingClientId = blockParentsClientIds.find(\n\t\t( parentClientId ) =>\n\t\t\tparentBlockListSettings[ parentClientId ]\n\t\t\t\t?.__experimentalCaptureToolbars\n\t);\n\n\treturn {\n\t\tclientId,\n\t\trootClientId: getBlockRootClientId( clientId ),\n\t\tname,\n\t\tisEmptyDefaultBlock:\n\t\t\tname && isUnmodifiedDefaultBlock( { name, attributes } ),\n\t\tcapturingClientId,\n\t};\n}\n\nexport default function WrappedBlockPopover( {\n\t__unstablePopoverSlot,\n\t__unstableContentRef,\n} ) {\n\tconst selected = useSelect( wrapperSelector, [] );\n\n\tif ( ! selected ) {\n\t\treturn null;\n\t}\n\n\tconst {\n\t\tclientId,\n\t\trootClientId,\n\t\tname,\n\t\tisEmptyDefaultBlock,\n\t\tcapturingClientId,\n\t} = selected;\n\n\tif ( ! name ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<SelectedBlockPopover\n\t\t\tclientId={ clientId }\n\t\t\trootClientId={ rootClientId }\n\t\t\tisEmptyDefaultBlock={ isEmptyDefaultBlock }\n\t\t\tcapturingClientId={ capturingClientId }\n\t\t\t__unstablePopoverSlot={ __unstablePopoverSlot }\n\t\t\t__unstableContentRef={ __unstableContentRef }\n\t\t/>\n\t);\n}\n"],"mappings":"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"}