{"version":3,"names":["encoding","_interopRequireWildcard","require","decoding","promise","error","string","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","deriveKey","secret","roomName","secretBuffer","encodeUtf8","buffer","salt","crypto","subtle","importKey","then","keyMaterial","name","iterations","hash","length","exports","encrypt","data","resolve","iv","getRandomValues","Uint8Array","cipher","encryptedDataEncoder","createEncoder","writeVarString","writeVarUint8Array","toUint8Array","encryptJson","dataEncoder","writeAny","decrypt","dataDecoder","createDecoder","algorithm","readVarString","reject","create","readVarUint8Array","decryptJson","decryptedValue","readAny"],"sources":["@wordpress/sync/src/y-webrtc/crypto.js"],"sourcesContent":["// File copied as is from the y-webrtc package.\n/* eslint-disable eslint-comments/disable-enable-pair */\n/* eslint-disable eslint-comments/no-unlimited-disable */\n/* eslint-disable */\n// @ts-nocheck\n/* eslint-env browser */\n\nimport * as encoding from 'lib0/encoding';\nimport * as decoding from 'lib0/decoding';\nimport * as promise from 'lib0/promise';\nimport * as error from 'lib0/error';\nimport * as string from 'lib0/string';\n\n/**\n * @param {string} secret\n * @param {string} roomName\n * @return {PromiseLike<CryptoKey>}\n */\nexport const deriveKey = ( secret, roomName ) => {\n\tconst secretBuffer = string.encodeUtf8( secret ).buffer;\n\tconst salt = string.encodeUtf8( roomName ).buffer;\n\treturn crypto.subtle\n\t\t.importKey( 'raw', secretBuffer, 'PBKDF2', false, [ 'deriveKey' ] )\n\t\t.then( ( keyMaterial ) =>\n\t\t\tcrypto.subtle.deriveKey(\n\t\t\t\t{\n\t\t\t\t\tname: 'PBKDF2',\n\t\t\t\t\tsalt,\n\t\t\t\t\titerations: 100000,\n\t\t\t\t\thash: 'SHA-256',\n\t\t\t\t},\n\t\t\t\tkeyMaterial,\n\t\t\t\t{\n\t\t\t\t\tname: 'AES-GCM',\n\t\t\t\t\tlength: 256,\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t\t[ 'encrypt', 'decrypt' ]\n\t\t\t)\n\t\t);\n};\n\n/**\n * @param {Uint8Array} data data to be encrypted\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} encrypted, base64 encoded message\n */\nexport const encrypt = ( data, key ) => {\n\tif ( ! key ) {\n\t\treturn /** @type {PromiseLike<Uint8Array>} */ (\n\t\t\tpromise.resolve( data )\n\t\t);\n\t}\n\tconst iv = crypto.getRandomValues( new Uint8Array( 12 ) );\n\treturn crypto.subtle\n\t\t.encrypt(\n\t\t\t{\n\t\t\t\tname: 'AES-GCM',\n\t\t\t\tiv,\n\t\t\t},\n\t\t\tkey,\n\t\t\tdata\n\t\t)\n\t\t.then( ( cipher ) => {\n\t\t\tconst encryptedDataEncoder = encoding.createEncoder();\n\t\t\tencoding.writeVarString( encryptedDataEncoder, 'AES-GCM' );\n\t\t\tencoding.writeVarUint8Array( encryptedDataEncoder, iv );\n\t\t\tencoding.writeVarUint8Array(\n\t\t\t\tencryptedDataEncoder,\n\t\t\t\tnew Uint8Array( cipher )\n\t\t\t);\n\t\t\treturn encoding.toUint8Array( encryptedDataEncoder );\n\t\t} );\n};\n\n/**\n * @param {Object} data data to be encrypted\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} encrypted data, if key is provided\n */\nexport const encryptJson = ( data, key ) => {\n\tconst dataEncoder = encoding.createEncoder();\n\tencoding.writeAny( dataEncoder, data );\n\treturn encrypt( encoding.toUint8Array( dataEncoder ), key );\n};\n\n/**\n * @param {Uint8Array} data\n * @param {CryptoKey?} key\n * @return {PromiseLike<Uint8Array>} decrypted buffer\n */\nexport const decrypt = ( data, key ) => {\n\tif ( ! key ) {\n\t\treturn /** @type {PromiseLike<Uint8Array>} */ (\n\t\t\tpromise.resolve( data )\n\t\t);\n\t}\n\tconst dataDecoder = decoding.createDecoder( data );\n\tconst algorithm = decoding.readVarString( dataDecoder );\n\tif ( algorithm !== 'AES-GCM' ) {\n\t\tpromise.reject( error.create( 'Unknown encryption algorithm' ) );\n\t}\n\tconst iv = decoding.readVarUint8Array( dataDecoder );\n\tconst cipher = decoding.readVarUint8Array( dataDecoder );\n\treturn crypto.subtle\n\t\t.decrypt(\n\t\t\t{\n\t\t\t\tname: 'AES-GCM',\n\t\t\t\tiv,\n\t\t\t},\n\t\t\tkey,\n\t\t\tcipher\n\t\t)\n\t\t.then( ( data ) => new Uint8Array( data ) );\n};\n\n/**\n * @param {Uint8Array} data\n * @param {CryptoKey?} key\n * @return {PromiseLike<Object>} decrypted object\n */\nexport const decryptJson = ( data, key ) =>\n\tdecrypt( data, key ).then( ( decryptedValue ) =>\n\t\tdecoding.readAny(\n\t\t\tdecoding.createDecoder( new Uint8Array( decryptedValue ) )\n\t\t)\n\t);\n"],"mappings":"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"}